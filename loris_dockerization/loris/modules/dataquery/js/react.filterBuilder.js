(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=53)})({0:function(module,exports){module.exports=React},53:function(module,exports,__webpack_require__){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}
/**
   *  The following file contains the components used for the filter builder tab
   *
   *  @author   Jordan Stirling <jstirling91@gmail.com>
   *  @license  http://www.gnu.org/licenses/gpl-3.0.txt GPLv3
   *  @link     https://github.com/mohadesz/Loris-Trunk
   */var LogicOperator=function(_Component){_inherits(LogicOperator,_Component);function LogicOperator(props){_classCallCheck(this,LogicOperator);var _this=_possibleConstructorReturn(this,(LogicOperator.__proto__||Object.getPrototypeOf(LogicOperator)).call(this,props));_this.changeOperator=_this.changeOperator.bind(_this);return _this}_createClass(LogicOperator,[{key:"changeOperator",value:function changeOperator(op){this.props.updateGroupOperator(op)}},{key:"render",value:function render(){var andClass="btn",orClass="btn";if(this.props.logicOperator===1){orClass+=" btn-primary";andClass+=" switch"}else{andClass+=" btn-primary";orClass+=" switch"}return _react2.default.createElement("div",{className:"btn-group",role:"group"},_react2.default.createElement("button",{type:"button",className:andClass,onClick:this.changeOperator.bind(this,0)},"And"),_react2.default.createElement("button",{type:"button",className:orClass,onClick:this.changeOperator.bind(this,1)},"Or"))}}]);return LogicOperator}(_react.Component);var FilterRule=function(_Component2){_inherits(FilterRule,_Component2);function FilterRule(props){_classCallCheck(this,FilterRule);var _this2=_possibleConstructorReturn(this,(FilterRule.__proto__||Object.getPrototypeOf(FilterRule)).call(this,props));_this2.state={operators:{equal:"=",notEqual:"!=",lessThanEqual:"<=",greaterThanEqual:">=",startsWith:"startsWith",contains:"contains",isNull:"isNull",isNotNull:"isNotNull"},value:""};_this2.selectInstrument=_this2.selectInstrument.bind(_this2);_this2.fieldSelect=_this2.fieldSelect.bind(_this2);_this2.operatorSelect=_this2.operatorSelect.bind(_this2);_this2.valueChange=_this2.valueChange.bind(_this2);_this2.valueSet=_this2.valueSet.bind(_this2);_this2.updateVisit=_this2.updateVisit.bind(_this2);return _this2}_createClass(FilterRule,[{key:"componentWillMount",value:function componentWillMount(){this.valueSet=loris.debounce(this.valueSet,1e3)}},{key:"selectInstrument",value:function selectInstrument(event){var _this3=this;var rule=this.props.rule;if(event.target.value){rule.instrument=event.target.value;$.get(loris.BaseURL+"/dataquery/ajax/datadictionary.php",{category:rule.instrument},function(data){rule.fields=data;_this3.props.updateRule(_this3.props.index,rule)},"json")}}},{key:"fieldSelect",value:function fieldSelect(event){var rule=JSON.parse(JSON.stringify(this.props.rule));delete rule.field;delete rule.fieldType;delete rule.operator;delete rule.value;delete rule.visit;delete rule.candidates;if(event.target.value){rule.field=rule.fields[event.target.value].key[1];rule.fieldType=rule.fields[event.target.value].value.Type}this.props.updateRule(this.props.index,rule)}},{key:"operatorSelect",value:function operatorSelect(event){var rule=JSON.parse(JSON.stringify(this.props.rule));delete rule.operator;delete rule.value;delete rule.visit;delete rule.candidates;if(event.target.value){rule.operator=event.target.value}this.props.updateRule(this.props.index,rule);if(rule.operator==="isNull"||rule.operator==="isNotNull"){this.setState({value:"null"});this.valueSet()}}},{key:"valueChange",value:function valueChange(event){var rule=JSON.parse(JSON.stringify(this.props.rule));delete rule.visit;delete rule.candidates;rule.value=event.target.value;this.setState({value:event.target.value});this.valueSet();this.props.updateRule(this.props.index,rule)}},{key:"valueSet",value:function valueSet(){var _this4=this;var rule=JSON.parse(JSON.stringify(this.props.rule));if(this.state.value){var responseHandler=function responseHandler(data){var i=void 0;var allSessions={};var allCandiates={};for(i=0;i<data.length;i++){if(!allSessions[data[i][1]]){allSessions[data[i][1]]=[]}allSessions[data[i][1]].push(data[i][0]);if(!allCandiates[data[i][0]]){allCandiates[data[i][0]]=[]}allCandiates[data[i][0]].push(data[i][1])}rule.candidates={allCandiates,allSessions};rule.session=Object.keys(allCandiates);rule.visit="All";_this4.props.updateSessions(_this4.props.index,rule)};var ajaxRetrieve=function ajaxRetrieve(script){$.get(loris.BaseURL+"/dataquery/ajax/"+script,{category:rule.instrument,field:rule.field,value:_this4.state.value},responseHandler,"json")};switch(rule.operator){case"equal":case"isNull":ajaxRetrieve("queryEqual.php");break;case"notEqual":case"isNotNull":ajaxRetrieve("queryNotEqual.php");break;case"lessThanEqual":ajaxRetrieve("queryLessThanEqual.php");break;case"greaterThanEqual":ajaxRetrieve("queryGreaterThanEqual.php");break;case"startsWith":ajaxRetrieve("queryStartsWith.php");break;case"contains":ajaxRetrieve("queryContains.php");break;default:break}}}},{key:"updateVisit",value:function updateVisit(event){var rule=JSON.parse(JSON.stringify(this.props.rule));rule.visit=event.target.value;if(event.target.value==="all"){rule.session=Object.keys(rule.candidates.allCandiates)}else{rule.session=rule.candidates.allSessions[event.target.value]}this.props.updateSessions(this.props.index,rule)}},{key:"render",value:function render(){var _this5=this;var rule=void 0;var fieldIndex=void 0;var forVisits=void 0;var visits=void 0;if(this.props.rule.instrument){var fields=this.props.rule.fields.map(function(field,index){if(_this5.props.rule.field&&field.key[1]===_this5.props.rule.field){fieldIndex=index}return _react2.default.createElement("option",{key:index,value:index},field.key[1])});var operators=[];var inputOptions=[];var input=[];var operatorKey="";var operatorSelect=[];var options=[];var value="";var inputType=[];if(this.props.rule.fieldType){inputType=this.props.rule.fieldType.split("(");operatorKey=inputType[0];for(var key in this.state.operators){operators.push(_react2.default.createElement("option",{value:key,onChange:this.operatorSelect},this.state.operators[key]))}value=this.props.rule.operator?this.props.rule.operator:"";operatorSelect=_react2.default.createElement("select",{className:"input-sm col-xs-3 ",onChange:this.operatorSelect,value},_react2.default.createElement("option",{value:""}),operators);if(this.props.rule.operator&&this.props.rule.operator!=="isNull"&&this.props.rule.operator!=="isNotNull"){switch(operatorKey){case"enum":inputOptions=enumToArray(this.props.rule.fieldType);options=inputOptions.map(function(option,index){return _react2.default.createElement("option",{key:index,value:option},option)});value=this.props.rule.value?this.props.rule.value:"";input=_react2.default.createElement("select",{className:"input-sm col-xs-3",onChange:this.valueChange,value},_react2.default.createElement("option",{value:""}),options);break;default:input=_react2.default.createElement("input",{type:"text",className:"input-sm col-xs-3",onChange:this.valueChange,value:this.props.rule.value});break}}if(this.props.rule.visit){visits=Object.keys(this.props.Visits).map(function(visit,index){return _react2.default.createElement("option",{key:index,value:visit},visit)});forVisits=_react2.default.createElement("select",{className:"input-sm col-xs-3",onChange:this.updateVisit,value:this.props.rule.visit},_react2.default.createElement("option",{value:"all"},"All Visits"),visits)}}rule=_react2.default.createElement("div",null,_react2.default.createElement("div",{className:"col-xs-12"},_react2.default.createElement("label",{className:"instrumentLabel"},this.props.rule.instrument)),_react2.default.createElement("div",{className:"col-xs-10"},_react2.default.createElement("select",{className:"input-sm col-xs-3",onChange:this.fieldSelect,value:fieldIndex},_react2.default.createElement("option",{value:""}),fields),operatorSelect,input,forVisits))}else{var _options=this.props.items.map(function(item,index){return _react2.default.createElement("option",{key:index,value:item.category},item.category)});rule=_react2.default.createElement("select",{onChange:this.selectInstrument,className:"input-sm col-xs-10"},_react2.default.createElement("option",{value:""}),_options)}return _react2.default.createElement("div",{className:"panel panel-default"},_react2.default.createElement("div",{className:"panel-body"},rule,_react2.default.createElement("div",{className:"col-xs-2"},_react2.default.createElement("button",{className:"btn btn-danger btn-sm pull-right",onClick:this.props.deleteRule.bind(this,this.props.index)},_react2.default.createElement("span",{className:"glyphicon glyphicon-remove"})," Delete"))))}}]);return FilterRule}(_react.Component);var FilterGroup=function(_Component3){_inherits(FilterGroup,_Component3);function FilterGroup(props){_classCallCheck(this,FilterGroup);var _this6=_possibleConstructorReturn(this,(FilterGroup.__proto__||Object.getPrototypeOf(FilterGroup)).call(this,props));_this6.state={};_this6.updateChild=_this6.updateChild.bind(_this6);_this6.updateGroupOperator=_this6.updateGroupOperator.bind(_this6);_this6.updateSessions=_this6.updateSessions.bind(_this6);_this6.addChild=_this6.addChild.bind(_this6);_this6.deleteChild=_this6.deleteChild.bind(_this6);return _this6}_createClass(FilterGroup,[{key:"updateChild",value:function updateChild(index,child){var group=this.props.group;group.children[index]=child;if(this.props.index){this.props.updateGroup(this.props.index,group)}else{this.props.updateFilter(group)}}},{key:"updateGroupOperator",value:function updateGroupOperator(operator){var group=this.props.group;group.activeOperator=operator;group.session=getSessions(group);if(this.props.index){this.props.updateGroup(this.props.index,group)}else{this.props.updateFilter(group)}}},{key:"updateSessions",value:function updateSessions(index,child){var group=this.props.group,sessions=[],session=[];group.children[index]=child;group.session=getSessions(group);if(this.props.index){this.props.updateSessions(this.props.index,group)}else{this.props.updateFilter(group)}}},{key:"addChild",value:function addChild(type){var child=void 0,group=this.props.group;if(type==="rule"){child={type:"rule"}}else{child={type:"group",activeOperator:0,children:[{type:"rule"}]}}group.children.push(child);if(this.props.index){this.props.updateGroup(this.props.index,group)}else{this.props.updateFilter(group)}}},{key:"deleteChild",value:function deleteChild(index){var group=this.props.group;group.children.splice(index,1);group.session=getSessions(group);if(this.props.index){this.props.updateGroup(this.props.index,group)}else{this.props.updateFilter(group)}}},{key:"render",value:function render(){var _this7=this;var logicOperator=_react2.default.createElement(LogicOperator,{logicOperator:this.props.group.activeOperator,updateGroupOperator:this.updateGroupOperator});var children=this.props.group.children.map(function(child,index){if(child.type==="rule"){return _react2.default.createElement("li",{key:index},_react2.default.createElement(FilterRule,{rule:child,items:_this7.props.items,index,updateRule:_this7.updateChild,updateSessions:_this7.updateSessions,deleteRule:_this7.deleteChild,Visits:_this7.props.Visits}))}else if(child.type==="group"){return _react2.default.createElement("li",{key:index},_react2.default.createElement(FilterGroup,{group:child,items:_this7.props.items,index,updateGroup:_this7.updateChild,updateSessions:_this7.updateSessions,deleteGroup:_this7.deleteChild,Visits:_this7.props.Visits}))}});var deleteButton=void 0;if(this.props.deleteGroup){deleteButton=_react2.default.createElement("button",{className:"btn btn-danger btn-sm pull-right",onClick:this.props.deleteGroup.bind(this,this.props.index)},_react2.default.createElement("span",{className:"glyphicon glyphicon-remove"})," Delete Group")}return _react2.default.createElement("div",{className:"tree"},_react2.default.createElement("ul",{className:"firstUL"},_react2.default.createElement("li",null,_react2.default.createElement("div",{className:"row"},_react2.default.createElement("div",{className:"col-xs-2"},logicOperator),_react2.default.createElement("div",{className:"col-xs-10"},deleteButton,_react2.default.createElement("button",{className:"btn btn-primary btn-sm pull-right",onClick:this.addChild.bind(this,"group")},_react2.default.createElement("span",{className:"glyphicon glyphicon-add"})," Add Group"),_react2.default.createElement("button",{className:"btn btn-primary btn-sm pull-right",onClick:this.addChild.bind(this,"rule")},_react2.default.createElement("span",{className:"glyphicon glyphicon-add"})," Add Rule"))),_react2.default.createElement("ul",null,children))))}}]);return FilterGroup}(_react.Component);var FilterBuilder=function(_Component4){_inherits(FilterBuilder,_Component4);function FilterBuilder(props){_classCallCheck(this,FilterBuilder);var _this8=_possibleConstructorReturn(this,(FilterBuilder.__proto__||Object.getPrototypeOf(FilterBuilder)).call(this,props));_this8.state={};return _this8}_createClass(FilterBuilder,[{key:"render",value:function render(){return _react2.default.createElement("div",null,_react2.default.createElement("h1",{className:"col-xs-12"},"Filter"),_react2.default.createElement("div",{className:"col-xs-12"},_react2.default.createElement("div",{className:"well well-primary"},_react2.default.createElement(FilterGroup,{group:this.props.filter,items:this.props.items,updateFilter:this.props.updateFilter,Visits:this.props.Visits}))))}}]);return FilterBuilder}(_react.Component);window.LogicOperator=LogicOperator;window.FilterRule=FilterRule;window.FilterGroup=FilterGroup;window.FilterBuilder=FilterBuilder;exports.default={LogicOperator,FilterRule,FilterGroup,FilterBuilder}}});
//# sourceMappingURL=react.filterBuilder.js.map